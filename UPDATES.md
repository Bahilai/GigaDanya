# üîÑ –ò—Å—Ç–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞

## üìÖ 04.11.2024 - –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ AI Studio Agent API

### ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞:

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **Yandex AI Studio Agent API** –≤–º–µ—Å—Ç–æ –±–∞–∑–æ–≤–æ–≥–æ Foundation Models API.

### üÜï –î–æ–±–∞–≤–ª–µ–Ω–æ:

#### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- **`YandexAgentModels.kt`** - –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Agent API
  - `AgentRequest` - –∑–∞–ø—Ä–æ—Å –∫ –∞–≥–µ–Ω—Ç—É
  - `AgentResponse` - –æ—Ç–≤–µ—Ç –æ—Ç –∞–≥–µ–Ω—Ç–∞
  - `PromptConfig` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞ –∞–≥–µ–Ω—Ç–∞
  - `OutputContent`, `ContentItem` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã–≤–æ–¥–∞
  - `ErrorInfo` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞–≥–µ–Ω—Ç–∞

- **`YandexAgentApi.kt`** - Retrofit –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è Agent API
  - Endpoint: `POST /responses`
  - Headers: Authorization, x-folder-id

- **`AGENT_MIGRATION.md`** - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏
- **`AGENT_SETUP_GUIDE.md`** - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∞–≥–µ–Ω—Ç–∞

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–∞—Ö:

1. **`app/build.gradle.kts`**:
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ `YANDEX_AGENT_ID` –∏–∑ `local.properties`
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è `BuildConfig.YANDEX_AGENT_ID`

2. **`RetrofitInstance.kt`**:
   - –î–æ–±–∞–≤–ª–µ–Ω `AGENT_BASE_URL`: `https://rest-assistant.api.cloud.yandex.net/v1/`
   - –°–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π `agentRetrofit` —ç–∫–∑–µ–º–ø–ª—è—Ä
   - –î–æ–±–∞–≤–ª–µ–Ω `agentApi` –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
   - –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–≤–æ–π—Å—Ç–≤–æ `agentId`
   - –°—Ç–∞—Ä—ã–π `api` –æ—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

3. **`ChatViewModel.kt`**:
   - –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω –º–µ—Ç–æ–¥ `fetchBotResponse()`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `AgentRequest` –≤–º–µ—Å—Ç–æ `YandexGptRequest`
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –æ—Ç Agent API
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∞–≥–µ–Ω—Ç–∞

4. **`README.md`**:
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± Agent ID
   - –°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏
   - –û–±–Ω–æ–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è

5. **`local.properties`**:
   - –î–æ–±–∞–≤–ª–µ–Ω `YANDEX_AGENT_ID`

### üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

1. **–ì–∏–±–∫–æ—Å—Ç—å**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞
2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏
3. **–£–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç—å**: –ü—Ä–æ–º–ø—Ç—ã –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ AI Studio
4. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –±–∞–∑ –∑–Ω–∞–Ω–∏–π –∏ –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
5. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ú–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∞–≥–µ–Ω—Ç–∞

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

**–°—Ç–∞—Ä—ã–π API (Foundation Models):**
```
POST https://llm.api.cloud.yandex.net/foundationModels/v1/completion
Body: { modelUri, completionOptions, messages }
```

**–ù–æ–≤—ã–π API (Agent):**
```
POST https://rest-assistant.api.cloud.yandex.net/v1/responses
Body: { prompt: { id, variables }, input, stream }
```

### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:

- –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏: [AGENT_MIGRATION.md](AGENT_MIGRATION.md)
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ: [AGENT_SETUP_GUIDE.md](AGENT_SETUP_GUIDE.md)

---

# üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫ (Context7)

## –û–±–Ω–æ–≤–ª–µ–Ω–æ –¥–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –≤–µ—Ä—Å–∏–π

### ‚úÖ –£—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ:

| –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –ò—Å—Ç–æ—á–Ω–∏–∫ |
|------------|------|-------|----------|
| **OkHttp** | 4.12.0 | **5.2.1** | Context7 |
| **Coil** | 2.5.0 | **3.3.0** | Context7 |
| **Lifecycle ViewModel** | 2.7.0 | **2.8.3** | Context7 |

### üì¶ –ù–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

- `coil-network-okhttp:3.3.0` - –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Coil 3.x

### üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

#### gradle/libs.versions.toml
```toml
# –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
okhttp = "5.2.1"           # –±—ã–ª–æ 4.12.0
coil = "3.3.0"             # –±—ã–ª–æ 2.5.0  
lifecycleViewmodel = "2.8.3"  # –±—ã–ª–æ 2.7.0

# –ù–æ–≤—ã–π namespace –¥–ª—è Coil 3.x
coil-compose = { group = "io.coil-kt.coil3", name = "coil-compose", version.ref = "coil" }
coil-network-okhttp = { group = "io.coil-kt.coil3", name = "coil-network-okhttp", version.ref = "coil" }
```

#### app/build.gradle.kts
```kotlin
// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ API –∫–ª—é—á–µ–π —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–µ —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
val localPropertiesFile = rootProject.file("local.properties")
var yandexApiKey = ""
var yandexFolderId = ""

if (localPropertiesFile.exists()) {
    val lines = localPropertiesFile.readLines()
    for (line in lines) {
        when {
            line.startsWith("YANDEX_API_KEY=") -> {
                yandexApiKey = line.substringAfter("=").trim()
            }
            line.startsWith("YANDEX_FOLDER_ID=") -> {
                yandexFolderId = line.substringAfter("=").trim()
            }
        }
    }
}

buildConfigField("String", "YANDEX_API_KEY", "\"$yandexApiKey\"")
buildConfigField("String", "YANDEX_FOLDER_ID", "\"$yandexFolderId\"")

// –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ Coil
implementation(libs.coil.network.okhttp)
```

### ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:

- **–ò–º–ø–æ—Ä—Ç—ã Coil** –æ—Å—Ç–∞–ª–∏—Å—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (`coil.compose.AsyncImage`)
- **API Retrofit** —Å–æ–≤–º–µ—Å—Ç–∏–º–æ
- **ViewModel Compose** –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ

### üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

#### OkHttp 5.2.1:
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å HTTP/2
- –õ—É—á—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏

#### Coil 3.3.0:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Kotlin Multiplatform
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏
- –õ—É—á—à–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Compose

#### Lifecycle ViewModel 2.8.3:
- –£–ª—É—á—à–µ–Ω–∏—è –≤ —Ä–∞–±–æ—Ç–µ —Å Compose
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–≥–æ–≤

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã BuildConfig:

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò–º–ø–æ—Ä—Ç `import com.bahilai.gigadanya.BuildConfig` –Ω–µ —Ä–∞–±–æ—Ç–∞–ª
**–ü—Ä–∏—á–∏–Ω–∞:** BuildConfig –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
**–†–µ—à–µ–Ω–∏–µ:** 
1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ API –∫–ª—é—á–µ–π –∏–∑ `local.properties` (–±–µ–∑ –∏–º–ø–æ—Ä—Ç–∞ `java.util.Properties`)
2. –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `./gradlew generateDebugBuildConfig`
3. BuildConfig —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ API –∫–ª—é—á–∏:
   ```java
<<<<<<< HEAD
   public static final String YANDEX_API_KEY = "***"; // –°–∫—Ä—ã—Ç–æ –∏–∑ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   public static final String YANDEX_FOLDER_ID = "***"; // –°–∫—Ä—ã—Ç–æ –∏–∑ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
=======
   public static final String YANDEX_API_KEY = "AQVNzO1osNSvWXajs-Xm4Vmf1d6f9KHE2e5h2v5j";
   public static final String YANDEX_FOLDER_ID = "b1g9c4e7uvjon9qd842q";
>>>>>>> 069cb25bb2159bafe8ca18362048d11512205ac1
   ```

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ Kotlin:

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π - –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω—ã —Å Kotlin 2.2.0, –ø—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª 2.0.21
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤–µ—Ä—Å–∏–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:
- **Kotlin:** `2.0.21` ‚Üí `2.2.0`
- **Compose BOM:** `2024.09.00` ‚Üí `2024.12.01`
- **Core KTX:** `1.10.1` ‚Üí `1.15.0`
- **Lifecycle:** `2.6.1` ‚Üí `2.8.7`
- **Activity Compose:** `1.8.0` ‚Üí `1.9.3`

### üìã –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
- [x] –ì–µ–Ω–µ—Ä–∞—Ü–∏—é BuildConfig —Å API –∫–ª—é—á–∞–º–∏
- [x] –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –≤–µ—Ä—Å–∏–π Kotlin –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫
- [x] –°–±–æ—Ä–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ó–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (Coil 3.x)
- [ ] HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Yandex GPT (OkHttp 5.x)
- [ ] –†–∞–±–æ—Ç—É ViewModel –≤ Compose

---

**–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ Context7** ‚úÖ
